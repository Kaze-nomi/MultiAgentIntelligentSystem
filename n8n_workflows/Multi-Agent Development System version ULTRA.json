{
  "name": "Multi-Agent Development System version ULTRA",
  "nodes": [
    {
      "parameters": {
        "path": "dev-task",
        "formTitle": "ğŸš€ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸",
        "formDescription": "ĞœÑƒĞ»ÑŒÑ‚Ğ¸Ğ°Ğ³ĞµĞ½Ñ‚Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°: Architect â†’ Code Writer â†’ Code Reviewer â†’ Documentation",
        "formFields": {
          "values": [
            {
              "fieldLabel": "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸",
              "fieldType": "textarea",
              "placeholder": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ JWT-Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ...",
              "requiredField": true
            },
            {
              "fieldLabel": "Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ† Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ",
              "placeholder": "username",
              "requiredField": true
            },
            {
              "fieldLabel": "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ",
              "placeholder": "my-repo",
              "requiredField": true
            },
            {
              "fieldLabel": "ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ²ĞµÑ‚ĞºĞ°",
              "placeholder": "main"
            }
          ]
        },
        "options": {}
      },
      "id": "98e14544-85cf-4d3e-9cdd-eabaee3ef78f",
      "name": "ğŸ“ Task Input",
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.1,
      "position": [
        -3520,
        128
      ],
      "webhookId": "dev-task"
    },
    {
      "parameters": {
        "jsCode": "const form = $input.first().json;\n\nreturn [{\n  json: {\n    task_description: form['ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸'],\n    repo_owner: form['Ğ’Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ† Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ'],\n    repo_name: form['ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ'],\n    base_branch: form['ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ²ĞµÑ‚ĞºĞ°'] || 'main'\n  }\n}];"
      },
      "id": "7778493b-6439-494b-88dc-8aa58f1ee4e2",
      "name": "ğŸ“‹ Prepare Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3296,
        128
      ]
    },
    {
      "parameters": {
        "url": "=https://api.github.com/repos/{{ $json.repo_owner }}/{{ $json.repo_name }}/git/trees/{{ $json.base_branch }}?recursive=1",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "options": {
          "timeout": 30000
        }
      },
      "id": "722b2b76-26ea-454c-bf68-97bda480a430",
      "name": "ğŸ“‚ Get Repo Structure",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3088,
        128
      ],
      "credentials": {
        "githubApi": {
          "id": "EuDjNHcUwsanYUOc",
          "name": "GitHub account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const formData = $('ğŸ“‹ Prepare Data').first().json;\nconst treeResponse = $input.first().json;\n\n// Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸\nconsole.log('Tree response keys:', Object.keys(treeResponse));\nconsole.log('Tree array length:', (treeResponse.tree || []).length);\nconsole.log('First 3 items:', JSON.stringify((treeResponse.tree || []).slice(0, 3), null, 2));\n\n// ĞŸĞ°Ñ€ÑĞ¸Ğ¼ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ\nconst structure = (treeResponse.tree || []).map(item => ({\n  path: item.path,\n  type: item.type === 'blob' ? 'file' : 'dir',\n  originalType: item.type,  // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚Ğ¸Ğ¿ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸\n  size: item.size || 0,\n  sha: item.sha\n}));\n\n// Ğ ĞĞ¡Ğ¨Ğ˜Ğ Ğ•ĞĞĞ«Ğ• Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ´Ğ»Ñ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²\nconst keyPatterns = [\n  // ===== ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ =====\n  /^readme\\.md$/i,\n  /^changelog\\.md$/i,\n  /^contributing\\.md$/i,\n  /^package\\.json$/,\n  /^package-lock\\.json$/,\n  /^requirements\\.txt$/,\n  /^pyproject\\.toml$/,\n  /^setup\\.py$/,\n  /^setup\\.cfg$/,\n  /^poetry\\.lock$/,\n  /^Pipfile$/,\n  /^docker-compose\\.ya?ml$/,\n  /^dockerfile$/i,\n  /^\\.env\\.example$/,\n  /^\\.env\\.sample$/,\n  /^tsconfig\\.json$/,\n  /^vite\\.config\\.(js|ts)$/,\n  /^webpack\\.config\\.js$/,\n  /^next\\.config\\.(js|mjs)$/,\n  /^nuxt\\.config\\.(js|ts)$/,\n  /^\\.eslintrc(\\.(js|json|yml))?$/,\n  /^\\.prettierrc(\\.(js|json|yml))?$/,\n  /^tailwind\\.config\\.(js|ts)$/,\n  /^cargo\\.toml$/i,\n  /^go\\.mod$/,\n  /^go\\.sum$/,\n  /^makefile$/i,\n  /^justfile$/i,\n  \n  // ===== Ğ¢Ğ¾Ñ‡ĞºĞ¸ Ğ²Ñ…Ğ¾Ğ´Ğ° =====\n  /^main\\.(py|js|ts|go|rs)$/,\n  /^index\\.(py|js|ts|tsx|jsx)$/,\n  /^app\\.(py|js|ts|tsx|jsx)$/,\n  /^server\\.(py|js|ts)$/,\n  /^run\\.(py|js|ts)$/,\n  /^cli\\.(py|js|ts)$/,\n  \n  // ===== Python Ñ„Ğ°Ğ¹Ğ»Ñ‹ =====\n  /\\.py$/,\n  \n  // ===== JavaScript/TypeScript =====\n  /^src\\/.*\\.(js|jsx|ts|tsx)$/,\n  /^lib\\/.*\\.(js|jsx|ts|tsx)$/,\n  /^app\\/.*\\.(js|jsx|ts|tsx)$/,\n  /^pages\\/.*\\.(js|jsx|ts|tsx)$/,\n  /^components\\/.*\\.(js|jsx|ts|tsx)$/,\n  /^hooks\\/.*\\.(js|jsx|ts|tsx)$/,\n  /^utils\\/.*\\.(js|ts)$/,\n  /^helpers\\/.*\\.(js|ts)$/,\n  /^services\\/.*\\.(js|ts)$/,\n  /^api\\/.*\\.(js|ts)$/,\n  /^routes?\\/.*\\.(js|ts)$/,\n  /^controllers?\\/.*\\.(js|ts)$/,\n  /^middleware\\/.*\\.(js|ts)$/,\n  /^models?\\/.*\\.(js|ts)$/,\n  /^schemas?\\/.*\\.(js|ts)$/,\n  /^types?\\/.*\\.(ts|d\\.ts)$/,\n  /^store\\/.*\\.(js|ts)$/,\n  /^config\\/.*\\.(js|ts|json)$/,\n  \n  // ===== Ğ”Ñ€ÑƒĞ³Ğ¸Ğµ ÑĞ·Ñ‹ĞºĞ¸ =====\n  /\\.go$/,\n  /\\.rs$/,\n  /\\.cpp$/,\n  /\\.cxx$/,\n  /\\.c$/,\n  /\\.java$/,\n  /build\\.gradle\\.kts$/,\n  /pom\\.xml$/,\n  \n  // ===== ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ¸ Ğ² Ğ¿Ğ¾Ğ´Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸ÑÑ… =====\n  /config\\/.*\\.(json|ya?ml|toml)$/,\n  /\\.github\\/workflows\\/.*\\.ya?ml$/\n];\n\n// ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ˜Ğ¡ĞšĞ›Ğ®Ğ§Ğ•ĞĞ˜Ğ¯\nconst excludePatterns = [\n  /node_modules\\//,\n  /\\.git\\//,\n  /dist\\//,\n  /build\\//,\n  /\\.next\\//,\n  /\\.nuxt\\//,\n  /out\\//,\n  /__pycache__\\//,\n  /\\.pytest_cache\\//,\n  /\\.mypy_cache\\//,\n  /\\.ruff_cache\\//,\n  /\\.venv\\//,\n  /venv\\//,\n  /\\.env\\//,\n  /env\\//,\n  /virtualenv\\//,\n  /\\.tox\\//,\n  /\\.eggs\\//,\n  /\\.egg-info\\//,\n  /htmlcov\\//,\n  /coverage\\//,\n  /\\.coverage/,\n  /\\.cache\\//,\n  /\\.temp\\//,\n  /\\.tmp\\//,\n  /target\\//,\n  /vendor\\//,\n  /\\.idea\\//,\n  /\\.vscode\\//,\n  /\\.DS_Store/,\n  /Thumbs\\.db/,\n  /\\.log$/,\n  /\\.min\\.(js|css)$/,\n  /\\.map$/,\n  /\\.bundle\\.(js|css)$/,\n  /test_.*\\.py$/,\n  /.*_test\\.py$/,\n  /.*\\.test\\.(js|ts|jsx|tsx)$/,\n  /.*\\.spec\\.(js|ts|jsx|tsx)$/,\n  /__tests__\\//,\n  /tests?\\//,\n];\n\n// ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹\nconst priorityPatterns = [\n  /^readme\\.md$/i,\n  /^package\\.json$/,\n  /^requirements\\.txt$/,\n  /^pyproject\\.toml$/,\n  /^main\\.(py|js|ts)$/,\n  /^index\\.(py|js|ts)$/,\n  /^app\\.(py|js|ts)$/,\n  /^server\\.(py|js|ts)$/,\n  /models?\\.py$/,\n  /schema\\.py$/,\n];\n\n// =====================================================\n// Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞĞĞ¯ Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ ĞĞ¦Ğ˜Ğ¯\n// =====================================================\nconst allFiles = structure.filter(item => {\n  // Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ 'file', Ğ° Ğ½Ğµ 'blob'!\n  if (item.type !== 'file') {\n    return false;\n  }\n  \n  // ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ° (100KB)\n  if (item.size > 100000) {\n    return false;\n  }\n  \n  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ\n  const isExcluded = excludePatterns.some(p => p.test(item.path));\n  if (isExcluded) {\n    return false;\n  }\n  \n  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ Ñ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğ¼Ğ¸ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ°Ğ¼Ğ¸\n  const matchesKey = keyPatterns.some(p => p.test(item.path));\n  return matchesKey;\n});\n\n// Ğ”Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸: ĞµÑĞ»Ğ¸ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ½Ğ°ÑˆĞ»Ğ¸, Ğ¿Ğ¾ĞºĞ°Ğ¶ĞµĞ¼ Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ\nif (allFiles.length === 0) {\n  console.log('=== DEBUGGING: No files matched ===');\n  \n  const filesOnly = structure.filter(i => i.type === 'file');\n  console.log(`Files in structure: ${filesOnly.length}`);\n  \n  if (filesOnly.length > 0) {\n    console.log('Sample files:', filesOnly.slice(0, 10).map(f => ({\n      path: f.path,\n      type: f.type,\n      size: f.size\n    })));\n    \n    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ\n    filesOnly.slice(0, 5).forEach(item => {\n      const excluded = excludePatterns.some(p => p.test(item.path));\n      const matched = keyPatterns.some(p => p.test(item.path));\n      const sizeOk = item.size <= 100000;\n      console.log(`File: ${item.path} | excluded: ${excluded} | matched: ${matched} | sizeOk: ${sizeOk}`);\n    });\n  }\n}\n\n// Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼: Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼Ğ¸\nconst sortedFiles = allFiles.sort((a, b) => {\n  const aPriority = priorityPatterns.some(p => p.test(a.path)) ? 0 : 1;\n  const bPriority = priorityPatterns.some(p => p.test(b.path)) ? 0 : 1;\n  \n  if (aPriority !== bPriority) {\n    return aPriority - bPriority;\n  }\n  \n  return a.size - b.size;\n});\n\n// Ğ‘ĞµÑ€Ñ‘Ğ¼ Ñ‚Ğ¾Ğ¿-50 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²\nconst filesToFetch = sortedFiles.slice(0, 50);\n\n// Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ SHA Ğ´Ğ»Ñ Ğ’Ğ¡Ğ•Ğ¥ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²\nconst existingFileShas = {};\nstructure.forEach(item => {\n  if (item.type === 'file') {\n    existingFileShas[item.path] = item.sha;\n  }\n});\n\n// Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ğ»Ğ¾Ğ³\nconsole.log('=== FINAL STATS ===');\nconsole.log(`Total items in structure: ${structure.length}`);\nconsole.log(`Total files: ${structure.filter(i => i.type === 'file').length}`);\nconsole.log(`Files matching patterns: ${allFiles.length}`);\nconsole.log(`Files to fetch: ${filesToFetch.length}`);\nif (filesToFetch.length > 0) {\n  console.log('First 10 files:', filesToFetch.slice(0, 10).map(f => f.path));\n}\n\nreturn [{\n  json: {\n    ...formData,\n    structure: structure,\n    files_to_fetch: filesToFetch,\n    existing_file_shas: existingFileShas,\n    stats: {\n      total_files: structure.filter(i => i.type === 'file').length,\n      matching_files: allFiles.length,\n      files_to_fetch: filesToFetch.length\n    }\n  }\n}];"
      },
      "id": "49d290ae-d35b-4c43-850e-ae2072297e4f",
      "name": "ğŸ” Analyze Structure",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2864,
        128
      ]
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst filesToFetch = data.files_to_fetch || [];\n\nif (filesToFetch.length === 0) {\n  return [{ json: { ...data, skip_fetch: true } }];\n}\n\nreturn filesToFetch.map(file => ({\n  json: { ...data, file_path: file.path, file_sha: file.sha }\n}));"
      },
      "id": "e6b6f99e-41f3-4f99-956d-3062d596f42e",
      "name": "ğŸ“„ Split Files",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2640,
        128
      ]
    },
    {
      "parameters": {
        "url": "=https://api.github.com/repos/{{ $json.repo_owner }}/{{ $json.repo_name }}/contents/{{ $json.file_path }}?ref={{ $json.base_branch }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "options": {
          "batching": {
            "batch": {
              "batchSize": 5,
              "batchInterval": 300
            }
          },
          "timeout": 20000
        }
      },
      "id": "5c429daa-8675-437a-a9f1-ccbb698407fd",
      "name": "ğŸ“¥ Fetch Contents",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2416,
        128
      ],
      "credentials": {
        "githubApi": {
          "id": "EuDjNHcUwsanYUOc",
          "name": "GitHub account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst firstItem = $('ğŸ” Analyze Structure').first().json;\n\nconst keyFiles = {};\nlet loaded = 0, failed = 0;\n\nitems.forEach(item => {\n  if (item.json.skip_fetch) return;\n  try {\n    const content = item.json.content;\n    const path = item.json.path || item.json.name;\n    if (content && path) {\n      keyFiles[path] = Buffer.from(content, 'base64').toString('utf-8');\n      loaded++;\n    }\n  } catch (e) { failed++; }\n});\n\nreturn [{\n  json: {\n    task_description: firstItem.task_description,\n    repo_owner: firstItem.repo_owner,\n    repo_name: firstItem.repo_name,\n    base_branch: firstItem.base_branch,\n    existing_file_shas: firstItem.existing_file_shas,  // ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‘Ğ¼ Ğ´Ğ°Ğ»ÑŒÑˆĞµ\n    repo_context: { structure: firstItem.structure, key_files: keyFiles },\n    files_loaded: loaded\n  }\n}];"
      },
      "id": "dffe7ccc-b02d-42bb-8b2e-6a1cc08bee25",
      "name": "ğŸ“¦ Aggregate Contents",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2208,
        128
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://project-manager:8000/workflow/process",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ task_description: $json.task_description, repo_owner: $json.repo_owner, repo_name: $json.repo_name, base_branch: $json.base_branch, repo_context: $json.repo_context, priority: 'high', max_review_iterations: 3 }) }}",
        "options": {
          "timeout": 600000
        }
      },
      "id": "631546d7-ce42-4224-81b7-d1d259c48a69",
      "name": "ğŸ¤– Call Project Manager",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1984,
        128
      ]
    },
    {
      "parameters": {
        "jsCode": "const aggregateData = $('ğŸ“¦ Aggregate Contents').first().json;\nconst pmResponse = $input.first().json;\n\n// ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ¡Ğ¢ĞĞ¢Ğ£Ğ¡Ğ\nif (pmResponse.status === 'failed') {\n  // Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ´Ğ»Ñ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ°\n  const errors = pmResponse.errors || [];\n  const agentResults = pmResponse.agent_results || {};\n  \n  let errorDetails = 'Pipeline failed:\\n';\n  \n  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ°Ğ³ĞµĞ½Ñ‚Ğ°\n  if (agentResults.code_writer) {\n    const cw = agentResults.code_writer;\n    if (!cw.files || cw.files.length === 0) {\n      errorDetails += 'âŒ Code Writer: No files generated\\n';\n      if (cw.implementation_notes) {\n        errorDetails += `   Notes: ${cw.implementation_notes.join(', ')}\\n`;\n      }\n    }\n  }\n  \n  errors.forEach(e => {\n    errorDetails += `âŒ ${e.step}: ${e.error}\\n`;\n  });\n  \n  throw new Error(errorDetails);\n}\n\n// ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ„Ğ°Ğ¹Ğ»Ñ‹\nconst files = pmResponse.files_to_create || [];\nif (files.length === 0) {\n  throw new Error('No files to create! Check agent_results for details.');\n}\n\nreturn [{\n  json: {\n    ...pmResponse,\n    repo_owner: aggregateData.repo_owner,\n    repo_name: aggregateData.repo_name,\n    base_branch: aggregateData.base_branch,\n    existing_file_shas: aggregateData.existing_file_shas  // Ğ”Ğ»Ñ UPDATE\n  }\n}];"
      },
      "id": "91cae53b-980b-4c1a-959b-62e83bd07bab",
      "name": "âœ… Check PM Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1760,
        128
      ]
    },
    {
      "parameters": {
        "url": "=https://api.github.com/repos/{{ $json.repo_owner }}/{{ $json.repo_name }}/git/refs/heads/{{ $json.base_branch }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "options": {}
      },
      "id": "9fab2454-8694-456c-abbf-50e7998d5c07",
      "name": "ğŸ”— Get Base SHA",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1296,
        0
      ],
      "credentials": {
        "githubApi": {
          "id": "EuDjNHcUwsanYUOc",
          "name": "GitHub account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const pmData = $('âœ… Check PM Response').first().json;\nconst shaResponse = $input.first().json;\n\nreturn [{ json: { ...pmData, base_sha: shaResponse.object.sha } }];"
      },
      "id": "ef7670a1-7bab-40a3-a085-ebc75170c948",
      "name": "Extract SHA",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1088,
        0
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.github.com/repos/{{ $json.repo_owner }}/{{ $json.repo_name }}/git/refs",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ ref: 'refs/heads/' + $json.branch_name, sha: $json.base_sha }) }}",
        "options": {}
      },
      "id": "49242abe-b468-439e-a808-192101f44c0d",
      "name": "ğŸŒ¿ Create Branch",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -864,
        0
      ],
      "credentials": {
        "githubApi": {
          "id": "EuDjNHcUwsanYUOc",
          "name": "GitHub account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const data = $('Extract SHA').first().json;\nconst files = data.files_to_create || [];\nconst existingShas = data.existing_file_shas || {};\n\nif (files.length === 0) {\n  throw new Error('No files to create!');\n}\n\nreturn files.map((file, index) => {\n  const contentBase64 = Buffer.from(file.content || '').toString('base64');\n  const action = file.action || 'create';\n  const existingSha = existingShas[file.path];  // SHA Ğ´Ğ»Ñ update\n  \n  return {\n    json: {\n      repo_owner: data.repo_owner,\n      repo_name: data.repo_name,\n      branch_name: data.branch_name,\n      commit_message: data.commit_message,\n      file_path: file.path,\n      file_content_base64: contentBase64,\n      file_action: action,\n      file_sha: action === 'update' && existingSha ? existingSha : null,  // SHA Ğ´Ğ»Ñ update!\n      file_index: index,\n      total_files: files.length,\n      source_agent: file.source_agent || 'unknown',\n      // Ğ”Ğ»Ñ PR\n      pr_title: data.pr_title,\n      pr_description: data.pr_description,\n      summary: data.summary,\n      base_branch: data.base_branch,\n      task_id: data.task_id,\n      tech_stack: data.tech_stack,\n      review_iterations: data.review_iterations,\n      agent_results: data.agent_results\n    }\n  };\n});"
      },
      "id": "e71e1f4c-bb73-4572-9a5d-47672a784c06",
      "name": "ğŸ“ Split Files to Create",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -640,
        0
      ]
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "=https://api.github.com/repos/{{ $json.repo_owner }}/{{ $json.repo_name }}/contents/{{ $json.file_path }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ (() => {\n  const body = {\n    message: $json.commit_message + ' [' + $json.file_path.split('/').pop() + ']',\n    content: $json.file_content_base64,\n    branch: $json.branch_name\n  };\n  // Ğ’ĞĞ–ĞĞ: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ SHA Ğ´Ğ»Ñ update\n  if ($json.file_sha) {\n    body.sha = $json.file_sha;\n  }\n  return JSON.stringify(body);\n})() }}",
        "options": {
          "batching": {
            "batch": {
              "batchSize": 1
            }
          },
          "timeout": 30000
        }
      },
      "id": "4a9a45f1-15cc-49a8-a7ba-924c50e4bcc9",
      "name": "ğŸ’¾ Create/Update Files",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -416,
        0
      ],
      "credentials": {
        "githubApi": {
          "id": "EuDjNHcUwsanYUOc",
          "name": "GitHub account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst firstItem = $('ğŸ“ Split Files to Create').first().json;\n\nlet success = 0, failed = 0;\nconst results = [];\nconst failedFiles = [];\n\nitems.forEach((item, idx) => {\n  const resp = item.json;\n  if (resp.content && resp.commit) {\n    success++;\n    results.push({ path: resp.content.path, status: 'success' });\n  } else {\n    failed++;\n    const errMsg = resp.message || 'Unknown error';\n    results.push({ path: `file_${idx}`, status: 'failed', error: errMsg });\n    failedFiles.push({ index: idx, error: errMsg });\n  }\n});\n\nreturn [{\n  json: {\n    ...firstItem,\n    files_created: success,\n    files_failed: failed,\n    results: results,\n    failed_files: failedFiles\n  }\n}];"
      },
      "id": "fe59a79e-66e1-479f-93f5-59660ac6f011",
      "name": "ğŸ“Š Aggregate Results",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -208,
        0
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.github.com/repos/{{ $json.repo_owner }}/{{ $json.repo_name }}/pulls",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ title: $json.pr_title, head: $json.branch_name, base: $json.base_branch, body: $json.pr_description }) }}",
        "options": {}
      },
      "id": "3c5c1185-072e-4674-b672-ba50e1e34930",
      "name": "ğŸ”€ Create PR",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        0,
        0
      ],
      "credentials": {
        "githubApi": {
          "id": "EuDjNHcUwsanYUOc",
          "name": "GitHub account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $('ğŸ“Š Aggregate Results').first().json;\nconst pr = $input.first().json;\n\n// Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚\nlet msg = `âœ… *Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°!*\\n\\n`;\nmsg += `ğŸ“‹ ${data.summary?.split('\\n')[0]?.substring(0, 80) || 'Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾'}\\n\\n`;\n\n// Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸\nmsg += `ğŸ”§ *Ğ¡Ñ‚ĞµĞº:* ${data.tech_stack?.primary_language || 'N/A'}\\n`;\nif (data.tech_stack?.frameworks?.length) {\n  msg += `ğŸ“¦ *Ğ¤Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€ĞºĞ¸:* ${data.tech_stack.frameworks.slice(0,3).join(', ')}\\n`;\n}\n\n// Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°\nmsg += `\\nğŸ“Š *Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°:*\\n`;\nmsg += `â€¢ Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ² ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾: ${data.files_created}/${data.total_files}\\n`;\nmsg += `â€¢ Review Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹: ${data.review_iterations || 0}\\n`;\n\n// ĞĞ³ĞµĞ½Ñ‚Ñ‹\nconst agents = data.agent_results || {};\nmsg += `\\nğŸ¤– *ĞĞ³ĞµĞ½Ñ‚Ñ‹:*\\n`;\nif (agents.architect?.components) {\n  msg += `â€¢ Architect: ${agents.architect.components.length} ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²\\n`;\n}\nif (agents.code_writer?.files) {\n  msg += `â€¢ Code Writer: ${agents.code_writer.files.length} Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²\\n`;\n}\nif (agents.code_reviewer?.result) {\n  const score = agents.code_reviewer.result.quality_score || 0;\n  msg += `â€¢ Code Reviewer: ${score}/10 Ğ±Ğ°Ğ»Ğ»Ğ¾Ğ²\\n`;\n}\nif (agents.documentation?.files) {\n  msg += `â€¢ Documentation: ${agents.documentation.files.length} Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²\\n`;\n}\n\n// PR\nmsg += `\\nğŸ”— [Pull Request #${pr.number}](${pr.html_url})`;\n\nreturn [{ json: { message: msg, pr_url: pr.html_url, success: true } }];"
      },
      "id": "94317f15-e881-4b9d-a614-a356352c3257",
      "name": "ğŸ“± Success Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        224,
        0
      ]
    },
    {
      "parameters": {
        "jsCode": "const data = $('ğŸ“Š Aggregate Results').first().json;\n\n// Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ…\nlet msg = `âŒ *ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²!*\\n\\n`;\nmsg += `ğŸ“‹ ${data.summary?.split('\\n')[0]?.substring(0, 60) || 'N/A'}\\n\\n`;\n\nmsg += `ğŸ“Š *Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°:*\\n`;\nmsg += `â€¢ Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾: ${data.files_created}\\n`;\nmsg += `â€¢ ĞÑˆĞ¸Ğ±Ğ¾Ğº: ${data.files_failed}\\n\\n`;\n\n// Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº\nconst failures = (data.failed_files || []).slice(0, 5);\nif (failures.length > 0) {\n  msg += `ğŸ” *ĞÑˆĞ¸Ğ±ĞºĞ¸:*\\n`;\n  failures.forEach(f => {\n    msg += `â€¢ ${f.error?.substring(0, 100)}\\n`;\n  });\n}\n\n// Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²\nconst agents = data.agent_results || {};\nmsg += `\\nğŸ¤– *Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²:*\\n`;\n\nif (agents.code_writer) {\n  const cw = agents.code_writer;\n  if (!cw.files || cw.files.length === 0) {\n    msg += `â€¢ âŒ Code Writer: ĞĞ• Ğ¡ĞĞ—Ğ”ĞĞ› Ğ¤ĞĞ™Ğ›Ğ«\\n`;\n    if (cw.implementation_notes?.length) {\n      msg += `  Notes: ${cw.implementation_notes[0]}\\n`;\n    }\n  } else {\n    msg += `â€¢ âœ… Code Writer: ${cw.files.length} Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²\\n`;\n  }\n}\n\nif (agents.code_reviewer === null) {\n  msg += `â€¢ âš ï¸ Code Reviewer: Ğ½Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½\\n`;\n}\n\nreturn [{ json: { message: msg, success: false } }];"
      },
      "id": "5bdae692-1f23-48cc-90a2-2dd2617a077d",
      "name": "ğŸ“± Error Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1296,
        256
      ]
    },
    {
      "parameters": {
        "chatId": "=6487984216",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "disable_web_page_preview": true,
          "parse_mode": "Markdown"
        }
      },
      "id": "59690877-9b6e-4bb5-80c9-4d782b4121b5",
      "name": "ğŸ“¤ Send Success",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        448,
        0
      ],
      "webhookId": "81f8a274-1f68-43f3-bc63-0fed2218eaca",
      "credentials": {
        "telegramApi": {
          "id": "kakDfZD7GZ0uQLva",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "=6487984216",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "652d5753-5f49-4deb-a57f-e46851c201f8",
      "name": "ğŸ“¤ Send Error",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1088,
        256
      ],
      "webhookId": "30c6d8d9-8828-4d7a-a5d3-20a549a9c268",
      "credentials": {
        "telegramApi": {
          "id": "kakDfZD7GZ0uQLva",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {},
      "id": "0652bc74-a6b8-4f5a-bab0-e424bab4e3ba",
      "name": "âœ… End",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        640,
        0
      ]
    },
    {
      "parameters": {},
      "id": "f9a8c961-9477-464e-a5cc-83f682238639",
      "name": "âŒ End",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -864,
        256
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $json.status }}",
              "rightValue": "failed",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "id": "2c921d36-eed4-45a6-8451-1939794200a1"
            },
            {
              "id": "2d422828-3a90-4be4-83b0-04d98231e755",
              "leftValue": "={{ $json.status }}",
              "rightValue": "error",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {
          "ignoreCase": true,
          "looseTypeValidation": true
        }
      },
      "id": "b6d6086f-cb87-4517-8076-7107ec2688ea",
      "name": "ğŸ”€ Is Success?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -1552,
        128
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "ğŸ“ Task Input": {
      "main": [
        [
          {
            "node": "ğŸ“‹ Prepare Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ Prepare Data": {
      "main": [
        [
          {
            "node": "ğŸ“‚ Get Repo Structure",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‚ Get Repo Structure": {
      "main": [
        [
          {
            "node": "ğŸ” Analyze Structure",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” Analyze Structure": {
      "main": [
        [
          {
            "node": "ğŸ“„ Split Files",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“„ Split Files": {
      "main": [
        [
          {
            "node": "ğŸ“¥ Fetch Contents",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¥ Fetch Contents": {
      "main": [
        [
          {
            "node": "ğŸ“¦ Aggregate Contents",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¦ Aggregate Contents": {
      "main": [
        [
          {
            "node": "ğŸ¤– Call Project Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤– Call Project Manager": {
      "main": [
        [
          {
            "node": "âœ… Check PM Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âœ… Check PM Response": {
      "main": [
        [
          {
            "node": "ğŸ”€ Is Success?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”— Get Base SHA": {
      "main": [
        [
          {
            "node": "Extract SHA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract SHA": {
      "main": [
        [
          {
            "node": "ğŸŒ¿ Create Branch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸŒ¿ Create Branch": {
      "main": [
        [
          {
            "node": "ğŸ“ Split Files to Create",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ Split Files to Create": {
      "main": [
        [
          {
            "node": "ğŸ’¾ Create/Update Files",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ Create/Update Files": {
      "main": [
        [
          {
            "node": "ğŸ“Š Aggregate Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š Aggregate Results": {
      "main": [
        [
          {
            "node": "ğŸ”€ Create PR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ Create PR": {
      "main": [
        [
          {
            "node": "ğŸ“± Success Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“± Success Message": {
      "main": [
        [
          {
            "node": "ğŸ“¤ Send Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“± Error Message": {
      "main": [
        [
          {
            "node": "ğŸ“¤ Send Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¤ Send Success": {
      "main": [
        [
          {
            "node": "âœ… End",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¤ Send Error": {
      "main": [
        [
          {
            "node": "âŒ End",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ Is Success?": {
      "main": [
        [
          {
            "node": "ğŸ”— Get Base SHA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“± Error Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2d0ec5fd-5efd-4b64-94db-97ca9ca6a439",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "28f87a46502090a63d81c1b0d194b30cb85aa507eb30004f35c39d5a49ec1f61"
  },
  "id": "2IfP47njK9Hr0TPZ",
  "tags": []
}